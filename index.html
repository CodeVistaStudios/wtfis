<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WTF is Fun? | Premium Dad Jokes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --card-gradient: linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.6) 100%);
        }
        
        body {
            background: var(--primary-gradient);
            font-family: system-ui, -apple-system, sans-serif;
        }

        .glass-card {
            background: var(--card-gradient);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::after {
            width: 200%;
            height: 200%;
        }

        .joke-container {
            min-height: 150px;
            perspective: 1000px;
        }

        .joke-card {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .joke-card.flipping {
            transform: rotateX(180deg);
        }

        .engagement-count {
            transition: all 0.3s ease;
        }

        .engagement-count.bump {
            transform: scale(1.25);
        }

        .loading-dots span {
            animation: loadingDots 1.4s infinite;
            opacity: 0;
        }

        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loadingDots {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .social-share-btn {
            transition: all 0.3s ease;
        }

        .social-share-btn:hover {
            transform: translateY(-3px);
            filter: brightness(1.1);
        }

        .notification {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .highlight {
            position: relative;
        }

        .highlight::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .highlight:hover::after {
            transform: scaleX(1);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <div class="container mx-auto max-w-4xl">
        <!-- Header Section -->
        <header class="text-center text-white space-y-4 mb-8">
            <h1 class="text-5xl font-bold tracking-tight">WTF is Fun?</h1>
            <p class="text-xl opacity-90">Premium Dad Jokes for Distinguished Humor</p>
        </header>

        <!-- Main Content -->
        <main class="space-y-8">
            <!-- Joke Card -->
            <div class="glass-card rounded-2xl p-8">
                <div class="joke-container flex items-center justify-center">
                    <div id="jokeCard" class="joke-card w-full">
                        <p id="jokeText" class="text-2xl md:text-3xl text-center font-medium text-gray-800"></p>
                        <div id="loadingSpinner" class="loading-dots text-center text-2xl hidden">
                            <span>.</span><span>.</span><span>.</span>
                        </div>
                    </div>
                </div>

                <!-- Error Alert -->
                <div id="errorAlert" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 my-4 rounded" role="alert">
                    <p id="errorText" class="font-medium"></p>
                </div>

                <!-- Engagement Section -->
                <div class="mt-8 space-y-6">
                    <div class="flex justify-center space-x-6">
                        <button id="likeBtn" class="btn flex items-center space-x-3 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600">
                            <i class="fas fa-thumbs-up"></i>
                            <span id="likeCount" class="engagement-count">0</span>
                        </button>
                        <button id="dislikeBtn" class="btn flex items-center space-x-3 px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600">
                            <i class="fas fa-thumbs-down"></i>
                            <span id="dislikeCount" class="engagement-count">0</span>
                        </button>
                    </div>

                    <div class="flex flex-wrap justify-center gap-4">
                        <button id="newJokeBtn" class="btn bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700">
                            <i class="fas fa-random mr-2"></i>New Joke
                        </button>
                        <button id="copyBtn" class="btn bg-gray-700 text-white px-6 py-3 rounded-lg hover:bg-gray-800">
                            <i class="fas fa-copy mr-2"></i>Copy
                        </button>
                        <button id="shareBtn" class="btn bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-share-alt mr-2"></i>Share
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Dad Joke Stats</h2>
                <div class="stats-grid">
                    <div class="text-center p-4 rounded-lg bg-white bg-opacity-50">
                        <p class="text-sm text-gray-600">Jokes Served</p>
                        <p id="jokeCount" class="text-2xl font-bold text-indigo-600">0</p>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-white bg-opacity-50">
                        <p class="text-sm text-gray-600">Total Laughs</p>
                        <p id="totalLikes" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-white bg-opacity-50">
                        <p class="text-sm text-gray-600">Joke Streak</p>
                        <p id="streak" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-8 text-center text-white opacity-75">
            <p>Made with ðŸ‘¨ and terrible humor</p>
        </footer>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="fixed top-4 right-4 max-w-sm hidden notification">
        <div class="bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg">
            <p id="notificationText"></p>
        </div>
    </div>

    <script>
        let jokeStats = {
            count: 0,
            totalLikes: 0,
            streak: 0
        };

        // Load stats from localStorage
        try {
            const savedStats = JSON.parse(localStorage.getItem('jokeStats'));
            if (savedStats) jokeStats = savedStats;
            updateStatsDisplay();
        } catch (e) {
            console.error('Error loading stats:', e);
        }

        function updateStatsDisplay() {
            document.getElementById('jokeCount').textContent = jokeStats.count;
            document.getElementById('totalLikes').textContent = jokeStats.totalLikes;
            document.getElementById('streak').textContent = jokeStats.streak;
            localStorage.setItem('jokeStats', JSON.stringify(jokeStats));
        }

        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            notification.classList.remove('hidden');
            setTimeout(() => {
                notification.classList.add('hidden');
            }, duration);
        }

        async function fetchJoke() {
            const jokeCard = document.getElementById('jokeCard');
            const jokeText = document.getElementById('jokeText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const errorAlert = document.getElementById('errorAlert');

            jokeCard.classList.add('flipping');
            jokeText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            errorAlert.classList.add('hidden');

            try {
                const response = await fetch('https://icanhazdadjoke.com/', {
    headers: {
        'Accept': 'application/json',
        'User-Agent': 'WTF is Fun (https://wtfis.fun)'  // Adding User-Agent header
    }
});

                if (!response.ok) throw new Error('Failed to fetch joke');

                const data = await response.json();
                
                setTimeout(() => {
                    jokeText.textContent = data.joke;
                    loadingSpinner.classList.add('hidden');
                    jokeText.classList.remove('hidden');
                    jokeCard.classList.remove('flipping');
                    
                    jokeStats.count++;
                    updateStatsDisplay();
                }, 600);
            } catch (err) {
                loadingSpinner.classList.add('hidden');
                document.getElementById('errorText').textContent = 
                    "Dad went out for milk... (API Error)";
                errorAlert.classList.remove('hidden');
                jokeCard.classList.remove('flipping');
            }
        }

        function bumpCounter(element) {
            element.classList.add('bump');
            setTimeout(() => element.classList.remove('bump'), 300);
        }

        async function copyToClipboard() {
            try {
                const jokeText = document.getElementById('jokeText');
                await navigator.clipboard.writeText(jokeText.textContent);
                showNotification('Joke copied to clipboard! ðŸ“‹');
            } catch (err) {
                showNotification('Failed to copy joke ðŸ˜¢');
            }
        }

        async function shareJoke() {
            try {
                const jokeText = document.getElementById('jokeText');
                await navigator.share({
                    title: 'Check out this dad joke!',
                    text: jokeText.textContent,
                    url: 'https://wtfis.fun'
                });
            } catch (err) {
                if (err.name !== 'AbortError') {
                    showNotification('Sharing not supported on this device ðŸ˜¢');
                }
            }
        }

        // Event Listeners
        document.getElementById('newJokeBtn').addEventListener('click', fetchJoke);
        document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
        document.getElementById('shareBtn').addEventListener('click', shareJoke);
        
        document.getElementById('likeBtn').addEventListener('click', () => {
            const likeCount = document.getElementById('likeCount');
            likeCount.textContent = parseInt(likeCount.textContent) + 1;
            bumpCounter(likeCount);
            jokeStats.totalLikes++;
            jokeStats.streak++;
            updateStatsDisplay();
            showNotification('Thanks for the laugh! ðŸ˜„');
        });

        document.getElementById('dislikeBtn').addEventListener('click', () => {
            const dislikeCount = document.getElementById('dislikeCount');
            dislikeCount.textContent = parseInt(dislikeCount.textContent) + 1;
            bumpCounter(dislikeCount);
            jokeStats.streak = 0;
            updateStatsDisplay();
            showNotification('Maybe the next one will be better! ðŸ¤ž');
        });

        // Initial joke fetch
        fetchJoke();
    </script>
</body>
</html>
